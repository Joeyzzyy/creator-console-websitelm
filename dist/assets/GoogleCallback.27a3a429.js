import{_ as F,a as p,h,w as i,d as l,e as u,b as d,f as a,c as P,k as g,j as x,g as _,n as C,t as y}from"./index.6f6ce723.js";const j={name:"GoogleCallback",data(){return{loading:!0,showSetPasswordForm:!1,setPasswordLoading:!1,setPasswordForm:{newPassword:"",confirmPassword:""}}},computed:{setPasswordStrength(){const t=this.setPasswordForm.newPassword;if(!t)return"";let e=0;switch(t.length>=8&&e++,/[A-Z]/.test(t)&&e++,/[a-z]/.test(t)&&e++,/\d/.test(t)&&e++,e){case 4:return"Strong";case 3:return"Medium";default:return"Weak"}},setPasswordStrengthClass(){return{Strong:"strength-strong",Medium:"strength-medium",Weak:"strength-weak"}[this.setPasswordStrength]||""}},methods:{validatePassword(t,e){return e?e.length<8?Promise.reject("Password must be at least 8 characters long"):/\d/.test(e)?/[A-Z]/.test(e)?/[a-z]/.test(e)?this.setPasswordForm.confirmPassword&&e!==this.setPasswordForm.confirmPassword?Promise.reject("The two passwords do not match"):Promise.resolve():Promise.reject("Password must contain at least one lowercase letter"):Promise.reject("Password must contain at least one uppercase letter"):Promise.reject("Password must contain at least one number"):Promise.reject("Please enter a new password!")},validateConfirmPassword(t,e){return e?e!==this.setPasswordForm.newPassword?Promise.reject("The two passwords do not match!"):Promise.resolve():Promise.reject("Please confirm your password!")},async handleSetPassword(){const{newPassword:t,confirmPassword:e}=this.setPasswordForm;if(!/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}$/.test(t)){this.$notification.error({message:"Error",description:"Password format is incorrect, please re-enter"});return}if(!t||!e){this.$notification.error({message:"Error",description:"Please fill in all fields"});return}this.setPasswordLoading=!0;try{const r=await p.changePassword({currentPassword:"",newPassword:t,confirmPassword:e,isInitPassword:!0});r.code===200?(this.$notification.success({message:"Success",description:"Password set successfully"}),this.$router.push("/dashboard")):r.code===400&&r.message==="Passwords do not match"?this.$notification.error({message:"Error",description:"The two passwords do not match"}):this.$notification.error({message:"Error",description:r.message||"Password setting failed"})}catch{this.$notification.error({message:"Error",description:"Network error, please try again"})}finally{this.setPasswordLoading=!1}}},async created(){var t,e,c;try{const r=new URLSearchParams(window.location.search),s=r.get("code"),n=r.get("state");if(!s)throw new Error("Authorization code not received");const o=await p.googleCallback(s,n);if(o&&o.code===200)localStorage.clear(),localStorage.setItem("intelickIsLoggedIn","true"),localStorage.setItem("accessToken",o.accessToken),(t=o.data)!=null&&t.customerId&&(localStorage.setItem("currentCustomerEmail",o.data.email),localStorage.setItem("currentCustomerId",o.data.customerId)),o.data.firstLogin?(this.loading=!1,this.showSetPasswordForm=!0):(this.$notification.success({message:"Welcome!",description:"Successfully logged in with Google"}),this.$router.push("/dashboard"));else throw new Error((o==null?void 0:o.message)||"Authentication failed")}catch(r){let s="Failed to complete Google authentication";if(r.response)switch((e=r.response.data)==null?void 0:e.code){case 401:r.response.data.message==="Password incorrect"?s="Password is incorrect, please try again":r.response.data.message==="User not find"&&(s="User does not exist, please register first");break;case 404:s="User does not exist, please register first";break;default:s=((c=r.response.data)==null?void 0:c.message)||"Google login failed"}this.$notification.error({message:"Authentication Failed",description:s}),setTimeout(()=>{this.$router.push("/login")},2e3)}finally{this.showSetPasswordForm||(this.loading=!1)}}},E={class:"callback-container",style:{width:"400px",padding:"40px",background:"rgba(255, 255, 255, 0.95)","border-radius":"24px","box-shadow":"0 8px 32px rgba(108, 152, 255, 0.15)",border:"1px solid rgba(108, 152, 255, 0.2)"}},I={key:0,class:"status-content"},L={key:0,class:"password-strength"};function z(t,e,c,r,s,n){const o=l("a-spin"),f=l("a-input-password"),w=l("a-form-item"),b=l("a-button"),S=l("a-form"),k=l("a-layout-content"),v=l("a-layout");return u(),h(v,{style:{height:"100vh",background:"linear-gradient(135deg, #E8F0FF 0%, #C7D9FF 100%)"}},{default:i(()=>[d(k,{style:{display:"flex","align-items":"center","justify-content":"center",height:"100%",padding:"20px"}},{default:i(()=>[a("div",E,[e[4]||(e[4]=a("div",{class:"logo-section"},[a("h2",{class:"app-title"},[a("span",{class:"website-text"},"Website"),a("span",{class:"lm-text"},"LM"),a("span",{class:"title-emoji"},"\u2726")])],-1)),s.loading?(u(),P("div",I,[d(o,{spinning:!0,size:"large"},{default:i(()=>e[2]||(e[2]=[a("div",{class:"status-message"},[a("div",{class:"status-title"},"Verifying Login..."),a("div",{class:"status-description"}," Please wait while we complete your Google authentication ")],-1)])),_:1})])):g("",!0),s.showSetPasswordForm?(u(),h(S,{key:1,layout:"vertical",onSubmit:x(n.handleSetPassword,["prevent"])},{default:i(()=>[d(w,{label:"New Password",rules:[{required:!0,message:"Please enter a new password!"},{validator:n.validatePassword}]},{default:i(()=>[d(f,{value:s.setPasswordForm.newPassword,"onUpdate:value":e[0]||(e[0]=m=>s.setPasswordForm.newPassword=m),placeholder:"Enter new password",size:"large",class:"custom-input"},null,8,["value"]),s.setPasswordForm.newPassword?(u(),P("div",L,[e[3]||(e[3]=_(" Password Strength: ")),a("span",{class:C(n.setPasswordStrengthClass)},y(n.setPasswordStrength),3)])):g("",!0)]),_:1},8,["rules"]),d(w,{label:"Confirm Password",rules:[{required:!0,message:"Please confirm your password!"},{validator:n.validateConfirmPassword}]},{default:i(()=>[d(f,{value:s.setPasswordForm.confirmPassword,"onUpdate:value":e[1]||(e[1]=m=>s.setPasswordForm.confirmPassword=m),placeholder:"Confirm your password",size:"large",class:"custom-input"},null,8,["value"])]),_:1},8,["rules"]),d(w,null,{default:i(()=>[d(b,{type:"primary",block:"",size:"large",onClick:n.handleSetPassword,class:"login-button",loading:s.setPasswordLoading},{default:i(()=>[_(y(s.setPasswordLoading?"Setting...":"Set Password"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["onSubmit"])):g("",!0)])]),_:1})]),_:1})}const M=F(j,[["render",z],["__scopeId","data-v-adfedbfd"]]);export{M as default};
