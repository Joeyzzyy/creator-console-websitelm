import{O as le,A as ae,P as re,U as ce,S as de,g as ee,c as ue}from"./index.a54b1187.js";import{_ as pe,l as ge,A as he,C as me,m as fe,p as ve,P as be,M as K,r as S,q as te,s as se,u as b,v as oe,c as m,f as e,b as p,w as y,t as g,F as P,x as z,y as ye,z as _e,a as q,d as v,e as f,i as O,k as Ce}from"./index.635c445a.js";const Se=ge({name:"ArticleEditor",components:{ArrowLeftOutlined:he,OrderedListOutlined:le,CloudUploadOutlined:me,CloudDownloadOutlined:fe,FileTextOutlined:ve,AlignLeftOutlined:ae,PictureOutlined:re,UnorderedListOutlined:ce,PlusOutlined:be,SectionWrapper:de,AModal:K,ATabs:K.TabPane,ATabPane:K.TabPane,AButton:K.Button,ATag:K.Tag},setup(){const t=S({title:"",subTitle:"",description:"",sections:[],pageStats:{genKeyword:[],wordCount:0,keywords:[],keywordStats:[]}}),s=S(!1),_=ye(),x=_e(),B=S(!0),T=S(null),R=async(o,n)=>{var i,d;try{B.value=!0,console.log("\u5F00\u59CB\u52A0\u8F7D\u6587\u7AE0\u6570, pageId:",o);const r=await q.getArticleById(o,n);if(console.log("API\u54CD\u5E94\u6570\u636E:",r),!(r!=null&&r.data))throw console.error("API\u54CD\u5E94\u4E2D\u6CA1\u6709data\u5B57\u6BB5"),new Error("\u65E0\u6548\u7684\u54CD\u5E94\u6570\u636E");const a=r.data;if(console.log("\u89E3\u6790\u5230\u7684\u6587\u7AE0\u6570\u636E:",a),!a)throw console.error("\u672A\u627E\u5230\u6587\u7AE0\u6570\u636E"),new Error("\u672A\u627E\u5230\u6587\u7AE0\u6570\u636E");console.log("\u6587\u7AE0\u9875\u9762\u7EDF\u8BA1\u4FE1\u606F:",a.pageStats),console.log("\u751F\u6210\u7684\u5173\u952E\u8BCD:",(i=a.pageStats)==null?void 0:i.genKeyword),console.log("\u5173\u952E\u8BCD\u7EDF\u8BA1:",(d=a.pageStats)==null?void 0:d.keywordStats),t.value=a,T.value=JSON.parse(JSON.stringify(a)),t.value.pageStats||(t.value.pageStats={genKeyword:[],keywordStats:[]}),I(),console.log("\u6587\u7AE0\u6570\u636E\u52A0\u8F7D\u5B8C\u6210\uFF0C\u5F53\u524DarticleData:",t.value)}catch(r){console.error("\u52A0\u8F7D\u6587\u7AE0\u9519\u8BEF:",r),console.error("\u9519\u8BEF\u8BE6\u60C5:",{message:r.message,stack:r.stack}),b.error(`\u52A0\u8F7D\u6587\u7AE0\u5931\u8D25: ${r.message||"\u672A\u77E5\u9519\u8BEF"}`)}finally{B.value=!1}},H=async()=>{try{s.value=!0;const o=b.loading("Saving...",0),n=V(t.value.sections);if(n.length>0){o(),console.log("\u9A8C\u8BC1\u9519\u8BEF:",n),n.forEach(l=>{b.error(l)});return}if(!_.query.id)throw new Error("Article ID not found");const i=t.value.title!==T.value.title||t.value.subTitle!==T.value.subTitle||t.value.description!==T.value.description;console.log("Comparing sections for changes:");const d=t.value.sections.filter((l,u)=>{const h=T.value.sections[u];return h?JSON.stringify(l)!==JSON.stringify(h):!0});console.log("Modified sections:",d);const r=[];if(i){const l={title:t.value.title,subTitle:t.value.subTitle,description:t.value.description};console.log("Sending page update request:",l),r.push(q.updatePage(_.query.id,l))}if(d.length>0&&d.forEach(l=>{console.log("Sending section update request:",l),r.push(q.updateSection(l.sectionId,l))}),r.length===0){o(),b.info("No changes detected");return}const a=await Promise.all(r);console.log("Update results:",a),o(),b.success("Saved successfully")}catch(o){console.error("Save failed:",o),b.error("Save failed: "+(o.message||"Unknown error"))}finally{s.value=!1}},V=o=>{const n=[];return console.log("=== Starting Validation ==="),console.log("Total sections:",o.length),o.forEach((i,d)=>{console.log(`
[Checking Section ${d+1}]`),console.log("Component Name:",i.componentName),console.log("Section Data:",JSON.stringify(i,null,2));let r=!1;const a=l=>{!l||Object.entries(l).forEach(([u,h])=>{if(["componentName","sectionId","display","color"].includes(u)){console.log(`Skipping special field: ${u}`);return}console.log(`Checking field: ${u}, Value:`,h),Array.isArray(h)?(console.log(`Field ${u} is array, length:`,h.length),h.forEach((k,N)=>{typeof k=="object"?a(k):(!k||typeof k=="string"&&!k.trim())&&(console.log(`Empty array item found in ${u}[${N}]`),r=!0)})):typeof h=="object"?(console.log(`Field ${u} is object, checking nested fields`),a(h)):(!h||typeof h=="string"&&!h.trim())&&(console.log(`Empty field found: ${u}`),r=!0)})};if(console.log(`
Checking topContent...`),a(i.topContent),console.log(`
Checking leftContent...`),a(i.leftContent),console.log(`
Checking rightContent...`),a(i.rightContent),console.log(`
Checking bottomContent...`),a(i.bottomContent),console.log(`
Checking direct fields...`),["title","subtitle","subTitle"].forEach(l=>{i[l]!==void 0&&(console.log(`Checking ${l}:`,i[l]),(!i[l]||!i[l].trim())&&(console.log(`Empty direct field found: ${l}`),r=!0))}),r){const l=i.componentName||"Unknown Section",u=`Section ${d+1} (${l}) contains empty fields`;console.log(`
Adding error:`,u),n.push(u)}}),console.log(`
=== Validation Summary ===`),console.log("Total errors found:",n.length),console.log("Errors:",n),n},W=()=>{x.push("/task-management")},$=o=>o.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),G=o=>{const n=document.querySelector(`[data-section-id="${o}"]`),i=100;n.getBoundingClientRect().top,document.querySelector(".editor-content").scrollTo({top:n.offsetTop-i,behavior:"smooth"})},Q=(o,n)=>{const i=[...t.value.sections];i[n]={...o},t.value={...t.value,sections:i},I()},w=S(!1),A=S(!1),M=S(!1),E=S(!1),X=te(()=>{if(!_.query.id)return"";const o=ue.domains.preview,i=(_.query.lang||"en")==="zh"?"zh/":"en/";return`${o}${i}${_.query.id}`}),F=()=>{w.value=!0};se(async()=>{const o=_.query.id,n=_.query.lang||"en";o?R(o,n):b.error("Article ID not found")});const c=async()=>{try{M.value=!0,await q.updatePageStatus(_.query.id,"publish"),t.value.publishStatus="publish",b.success("Article published successfully"),w.value=!1}catch(o){console.error("Publish failed:",o),b.error("Failed to publish article")}finally{M.value=!1}},C=async()=>{try{E.value=!0,await q.updatePageStatus(_.query.id,"unpublish"),t.value.publishStatus="unpublish",b.success("Article unpublished successfully"),A.value=!1}catch(o){console.error("Unpublish failed:",o),b.error("Failed to unpublish article")}finally{E.value=!1}},L=()=>{w.value=!1},j=()=>{A.value=!1},J=()=>{A.value=!0},U=S("guidelines"),D=S({wordCount:0,headingsCount:0,paragraphsCount:0,imagesCount:0}),I=()=>{var l,u,h,k;let o=0,n=0,i=0,d=0,r=0;const a=N=>{!N||Object.entries(N).forEach(([Y,Z])=>{if(typeof Z=="object")a(Z);else switch(Z){case"h1":o++;break;case"h2":n++;break;case"h3":i++;break;case"p":d++;break;case"img":r++;break}})};(u=(l=t.value)==null?void 0:l.sections)==null||u.forEach(N=>{const Y=ee(N.componentName);Y&&a(Y)}),D.value={h1Count:o,h2Count:n,h3Count:i,paragraphsCount:d,imagesCount:r,wordCount:((k=(h=t.value)==null?void 0:h.pageStats)==null?void 0:k.wordCount)||0}},ne=te(()=>{const o=[];return t.value.sections.forEach(n=>{const i=ee(n.componentName);if(i){const d={sectionName:$(n.componentName),tags:[],sectionId:n.sectionId};Object.entries(i).forEach(([r,a])=>{if(a.match(/^h[123]$/)||a==="p"){let l=0;a.startsWith("h")?l=parseInt(a.charAt(1)):a==="p"&&(l=4),d.tags.push({id:`${n.sectionId}-${r}`,type:a,level:l})}}),d.tags.sort((r,a)=>r.level-a.level),d.tags.length>0&&o.push(d)}}),o}),ie=o=>{var i,d,r,a,l;console.log("========= \u5F00\u59CB\u67E5\u627E\u5173\u952E\u8BCD\u7EDF\u8BA1 ========="),console.log("\u67E5\u627E\u7684\u5173\u952E\u8BCD:",o),console.log("\u5F53\u524D\u6240\u6709\u5173\u952E\u8BCD\u7EDF\u8BA1\u6570\u636E:",(d=(i=t.value)==null?void 0:i.pageStats)==null?void 0:d.keywordStats);const n=(l=(a=(r=t.value)==null?void 0:r.pageStats)==null?void 0:a.keywordStats)==null?void 0:l.find(u=>(console.log("\u6B63\u5728\u6BD4\u8F83:",{\u5F53\u524D\u7EDF\u8BA1\u9879\u7684\u5173\u952E\u8BCD:u.keyword,\u5F53\u524D\u7EDF\u8BA1\u9879\u7684\u5173\u952E\u8BCD\u5C0F\u5199:u.keyword.toLowerCase(),\u67E5\u627E\u7684\u5173\u952E\u8BCD\u5C0F\u5199:o.toLowerCase(),\u662F\u5426\u5339\u914D:u.keyword.toLowerCase()===o.toLowerCase()}),u.keyword.toLowerCase()===o.toLowerCase()));return console.log("\u627E\u5230\u7684\u7EDF\u8BA1\u7ED3\u679C:",n),console.log("========= \u5173\u952E\u8BCD\u7EDF\u8BA1\u67E5\u627E\u7ED3\u675F ========="),n};return oe(()=>{var o,n;return(n=(o=t.value)==null?void 0:o.pageStats)==null?void 0:n.keywordStats},o=>{console.log("\u5173\u952E\u8BCD\u7EDF\u8BA1\u6570\u636E\u53D1\u751F\u53D8\u5316:",{\u7EDF\u8BA1\u6570\u636E\u603B\u6570:(o==null?void 0:o.length)||0,\u8BE6\u7EC6\u6570\u636E:o})},{deep:!0}),oe(()=>{var o,n;return(n=(o=t.value)==null?void 0:o.pageStats)==null?void 0:n.genKeyword},o=>{console.log("\u751F\u6210\u7684\u5173\u952E\u8BCD\u5217\u8868\u53D1\u751F\u53D8\u5316:",{\u5173\u952E\u8BCD\u603B\u6570:(o==null?void 0:o.length)||0,\u5173\u952E\u8BCD\u5217\u8868:o})},{deep:!0}),se(()=>{console.log("\u7EC4\u4EF6\u6302\u8F7D\u5B8C\u6210"),console.log("\u521D\u59CBarticleData:",t.value)}),{articleData:t,saving:s,handleSave:H,handleBack:W,formatSectionName:$,scrollToSection:G,loading:B,handleSectionUpdate:Q,isPublishModalVisible:w,isUnpublishModalVisible:A,publishLoading:M,unpublishLoading:E,showPublishModal:F,showUnpublishModal:J,handlePublish:c,handleUnpublish:C,cancelPublish:L,cancelUnpublish:j,previewUrl:X,activeTab:U,contentMetrics:D,documentStructure:ne,getKeywordStats:ie}}}),we={class:"article-editor"},ke={key:0,class:"loading-overlay"},Oe={key:1},Ae={class:"side-nav"},Ue={class:"guidelines-content"},Pe={class:"guideline-section"},Te={class:"metrics-grid"},Le={class:"metric-card headings-card"},Ne={class:"metric-icon"},$e={class:"metric-info"},Me={class:"heading-stats"},Ee={class:"heading-stat"},De={class:"stat-value"},Ie={class:"heading-stat"},Ke={class:"stat-value"},qe={class:"heading-stat"},Be={class:"stat-value"},Fe={class:"metric-row"},je={class:"metric-card"},Je={class:"metric-icon"},ze={class:"metric-info"},Re={class:"metric-value"},He={class:"metric-card"},Ve={class:"metric-icon"},We={class:"metric-info"},Ge={class:"metric-value"},Qe={class:"metric-card word-count-card"},Xe={class:"metric-icon"},Ye={class:"metric-info"},Ze={class:"metric-value"},xe={class:"document-structure"},et={class:"structure-tree"},tt=["onClick"],st={class:"section-content"},ot={class:"section-name"},nt={class:"section-tags"},it={class:"nav-sections"},lt={class:"keywords-section"},at={class:"debug-info",style:{"font-size":"12px",color:"#666","margin-bottom":"8px"}},rt={class:"keywords-list"},ct={class:"keyword-info"},dt={class:"keyword-name"},ut={key:0,class:"keyword-density"},pt={class:"count-number"},gt={class:"density-number"},ht={class:"editor-header"},mt={class:"header-actions"},ft={class:"preview-link"},vt=["href"],bt={class:"editor-content"},yt={class:"sections-container"},_t=["data-section-id"],Ct={class:"section-header"},St={class:"confirmation-content"},wt={class:"confirmation-section"},kt={class:"confirmation-item"},Ot={class:"item-value"},At={class:"confirmation-content"},Ut={class:"confirmation-section"},Pt={class:"confirmation-item"},Tt={class:"item-value"};function Lt(t,s,_,x,B,T){const R=v("UnorderedListOutlined"),H=v("AlignLeftOutlined"),V=v("PictureOutlined"),W=v("FileTextOutlined"),$=v("a-tab-pane"),G=v("a-tabs"),Q=v("ArrowLeftOutlined"),w=v("a-button"),A=v("a-tag"),M=v("CloudDownloadOutlined"),E=v("CloudUploadOutlined"),X=v("section-wrapper"),F=v("a-modal");return f(),m(P,null,[e("div",we,[t.loading?(f(),m("div",ke,s[3]||(s[3]=[e("div",{class:"loading-spinner"},[e("div",{class:"spinner"}),e("span",null,"Loading...")],-1)]))):(f(),m("div",Oe,[e("div",Ae,[p(G,{activeKey:t.activeTab,"onUpdate:activeKey":s[0]||(s[0]=c=>t.activeTab=c)},{default:y(()=>[p($,{key:"guidelines",tab:"Guidelines"},{default:y(()=>[e("div",Ue,[e("div",Pe,[s[11]||(s[11]=e("h3",{class:"section-title"},"Basic Statistics",-1)),e("div",Te,[e("div",Le,[e("div",Ne,[p(R)]),e("div",$e,[e("div",Me,[e("div",Ee,[s[4]||(s[4]=e("span",{class:"stat-label"},"H1",-1)),e("span",De,g(t.contentMetrics.h1Count),1)]),e("div",Ie,[s[5]||(s[5]=e("span",{class:"stat-label"},"H2",-1)),e("span",Ke,g(t.contentMetrics.h2Count),1)]),e("div",qe,[s[6]||(s[6]=e("span",{class:"stat-label"},"H3",-1)),e("span",Be,g(t.contentMetrics.h3Count),1)])])])]),e("div",Fe,[e("div",je,[e("div",Je,[p(H)]),e("div",ze,[s[7]||(s[7]=e("span",{class:"metric-label"},"Paragraphs",-1)),e("span",Re,g(t.contentMetrics.paragraphsCount),1)])]),e("div",He,[e("div",Ve,[p(V)]),e("div",We,[s[8]||(s[8]=e("span",{class:"metric-label"},"Images",-1)),e("span",Ge,g(t.contentMetrics.imagesCount),1)])])]),e("div",Qe,[e("div",Xe,[p(W)]),e("div",Ye,[s[9]||(s[9]=e("span",{class:"metric-label"},"Total Words",-1)),e("span",Ze,g(t.contentMetrics.wordCount),1)])])]),e("div",xe,[s[10]||(s[10]=e("h3",{class:"section-title"},"Main Structure",-1)),e("div",et,[(f(!0),m(P,null,z(t.documentStructure,c=>(f(),m("div",{key:c.sectionName,class:"tree-section",onClick:C=>t.scrollToSection(c.sectionId),role:"button",tabindex:"0"},[e("div",st,[e("div",ot,g(c.sectionName),1),e("div",nt,[(f(!0),m(P,null,z(c.tags,C=>(f(),m("span",{key:C.id,class:"tag-badge"},g(C.type),1))),128))])])],8,tt))),128))])])])])]),_:1}),p($,{key:"outline",tab:"Keywords"},{default:y(()=>{var c,C,L,j,J;return[e("div",it,[e("div",lt,[s[14]||(s[14]=e("h3",{class:"section-title"},"Keywords Analysis",-1)),e("div",at," Keywords Count: "+g(((L=(C=(c=t.articleData)==null?void 0:c.pageStats)==null?void 0:C.genKeyword)==null?void 0:L.length)||0),1),e("div",rt,[(f(!0),m(P,null,z(((J=(j=t.articleData)==null?void 0:j.pageStats)==null?void 0:J.genKeyword)||[],U=>{var D,I;return f(),m("div",{key:U,class:"keyword-item"},[e("div",ct,[e("div",dt,g(U),1),t.getKeywordStats(U)?(f(),m("div",ut,[s[12]||(s[12]=O(" Occurrences: ")),e("span",pt,g(((D=t.getKeywordStats(U))==null?void 0:D.wordCount)||0),1),s[13]||(s[13]=O(" | Density: ")),e("span",gt,g((((I=t.getKeywordStats(U))==null?void 0:I.density)||0).toFixed(2))+"%",1)])):Ce("",!0)])])}),128))])])])]}),_:1})]),_:1},8,["activeKey"])]),e("div",ht,[p(w,{type:"link",onClick:t.handleBack},{default:y(()=>[p(Q),s[15]||(s[15]=O(" Back "))]),_:1},8,["onClick"]),e("div",mt,[e("div",ft,[s[16]||(s[16]=e("span",null,"Preview From:",-1)),e("a",{href:t.previewUrl,target:"_blank"},g(t.previewUrl),9,vt)]),t.articleData.publishStatus==="publish"?(f(),m(P,{key:0},[p(A,{color:"green"},{default:y(()=>s[17]||(s[17]=[O("Published")])),_:1}),p(w,{type:"link",onClick:t.showUnpublishModal,class:"unpublish-article-btn"},{default:y(()=>[p(M),s[18]||(s[18]=O(" Unpublish "))]),_:1},8,["onClick"])],64)):(f(),m(P,{key:1},[p(A,{color:"orange"},{default:y(()=>s[19]||(s[19]=[O("Unpublished")])),_:1}),p(w,{type:"link",onClick:t.showPublishModal,class:"publish-article-btn"},{default:y(()=>[p(E),s[20]||(s[20]=O(" Publish "))]),_:1},8,["onClick"])],64)),p(w,{type:"primary",onClick:t.handleSave,loading:t.saving},{default:y(()=>s[21]||(s[21]=[O(" Save Changes ")])),_:1},8,["onClick","loading"])])]),e("div",bt,[e("div",yt,[(f(!0),m(P,null,z(t.articleData.sections,(c,C)=>(f(),m("div",{key:c.sectionId,class:"section-wrapper","data-section-id":c.sectionId},[e("div",Ct,[e("h3",null,g(t.formatSectionName(c.componentName)),1)]),p(X,{section:c,onUpdate:L=>t.handleSectionUpdate(L,C)},null,8,["section","onUpdate"])],8,_t))),128))])])]))]),p(F,{open:t.isPublishModalVisible,"onUpdate:open":s[1]||(s[1]=c=>t.isPublishModalVisible=c),title:"Publish Article",onOk:t.handlePublish,onCancel:t.cancelPublish,confirmLoading:t.publishLoading,wrapClassName:"custom-modal"},{default:y(()=>[e("div",St,[e("div",wt,[s[23]||(s[23]=e("h4",null,"Confirm Publication",-1)),e("div",kt,[s[22]||(s[22]=e("div",{class:"item-label"},"Article Title",-1)),e("div",Ot,g(t.articleData.title),1)]),s[24]||(s[24]=e("div",{class:"item-description"}," Publishing this article will make it visible to the public. Are you sure you want to proceed? ",-1))])])]),_:1},8,["open","onOk","onCancel","confirmLoading"]),p(F,{open:t.isUnpublishModalVisible,"onUpdate:open":s[2]||(s[2]=c=>t.isUnpublishModalVisible=c),title:"Unpublish Article",onOk:t.handleUnpublish,onCancel:t.cancelUnpublish,confirmLoading:t.unpublishLoading,wrapClassName:"custom-modal warning-modal"},{default:y(()=>[e("div",At,[e("div",Ut,[s[26]||(s[26]=e("h4",null,"Confirm Unpublication",-1)),e("div",Pt,[s[25]||(s[25]=e("div",{class:"item-label"},"Article Title",-1)),e("div",Tt,g(t.articleData.title),1)]),s[27]||(s[27]=e("div",{class:"item-description warning-text"}," Unpublishing this article will make it invisible to the public. Are you sure you want to proceed? ",-1))])])]),_:1},8,["open","onOk","onCancel","confirmLoading"])],64)}const Mt=pe(Se,[["render",Lt],["__scopeId","data-v-92466e5b"]]);export{Mt as default};
